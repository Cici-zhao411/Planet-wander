<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>行星旅人 | 旅行记录</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <a class="brand" href="index.html">Planet Wander</a>
        <div class="nav-links">
          <a href="index.html" class="active">首页</a>
          <a href="about.html">个人简介</a>
          <a href="routes.html">累计旅行路线</a>
        </div>
      </div>
    </nav>

    <main>
      <section class="hero">
        <div>
          <p class="section-title">Explorer Log</p>
          <h1>在路上，记录风景与故事</h1>
          <p>保持好奇、保持敬畏。沿着山脉、海岸与城市的灯火，在星球研究所式的审视中收集自然与人文的细节，让每一次远行都留下可再访的线索。</p>
          <div class="badge-list">
            <span class="badge">34座城市</span>
            <span class="badge">12000+ km</span>
            <span class="badge">持续更新</span>
          </div>
        </div>
        <div class="hero-card hero-card-photo" id="hero-card-photo">
          <div class="hero-card-actions">
            <button class="ghost-btn hero-card-upload" id="hero-card-upload">上传背景</button>
            <button class="ghost-btn hero-card-edit" id="hero-card-edit">编辑足迹文案</button>
          </div>
          <input type="file" id="hero-card-input" accept="image/*" hidden>
          <div class="hero-card-content">
            <h3 id="hero-title">最新足迹 · 新疆</h3>
            <p id="hero-description">追逐阿勒泰的晨雾、喀纳斯的湖光，以及乌鲁木齐街区里交织的多元气息。</p>
            <div style="margin-top:1rem;display:flex;gap:1rem;flex-wrap:wrap;">
              <div>
                <span class="stat">48h</span>
                <p class="muted">城市观察</p>
              </div>
              <div>
                <span class="stat">14</span>
                <p class="muted">影像片段</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section>
        <div class="section-heading">
          <p class="section-title">Footage Stream</p>
          <div class="gallery-controls">
            <button class="ghost-btn" id="gallery-add-btn">添加照片</button>
            <span class="hint">本地上传，仅存储在浏览器</span>
            <input type="file" id="gallery-add-input" accept="image/*" hidden>
          </div>
        </div>
        <div class="loop-gallery">
          <div class="loop-track" data-loop-track>
          <figure class="masonry-item">
            <img src="assets/images/1000001781.jpg" alt="旅途影像 1000001781">
            <span>行程片段 · 1000001781</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/1000001783.jpg" alt="旅途影像 1000001783">
            <span>行程片段 · 1000001783</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/208.jpg" alt="旅途影像 208">
            <span>行程片段 · 208</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/302.jpg" alt="旅途影像 302">
            <span>行程片段 · 302</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/388.jpg" alt="旅途影像 388">
            <span>行程片段 · 388</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/dji_mimo_20250612_180504_20250612180505_1749723892535_photo.jpg" alt="旅途影像 dji_mimo 180504">
            <span>行程片段 · dji_mimo 180504</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/IMG_3342.jpeg" alt="旅途影像 IMG_3342">
            <span>行程片段 · IMG_3342</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/IMG_3349.jpeg" alt="旅途影像 IMG_3349">
            <span>行程片段 · IMG_3349</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/IMG_3353.jpeg" alt="旅途影像 IMG_3353">
            <span>行程片段 · IMG_3353</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/IMG_3425.jpeg" alt="旅途影像 IMG_3425">
            <span>行程片段 · IMG_3425</span>
          </figure>
          <figure class="masonry-item">
            <img src="assets/images/IMG_3475.jpeg" alt="旅途影像 IMG_3475">
            <span>行程片段 · IMG_3475</span>
          </figure>
          </div>
        </div>
      </section>
    </main>

    <footer>
      © <span id="year"></span> 行星旅人 · 记录每一段地理现场
    </footer>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear();
      const loopTrack = document.querySelector('[data-loop-track]');
      const galleryAddBtn = document.getElementById('gallery-add-btn');
      const galleryAddInput = document.getElementById('gallery-add-input');
      const GALLERY_KEY = 'loop-gallery-photos';
      const STORY_KEY = 'gallery-photo-stories';
      let storyStore = {};
      try {
        storyStore = JSON.parse(localStorage.getItem(STORY_KEY) || '{}');
      } catch (err) {
        storyStore = {};
      }

      const attachStoryHandlers = () => {
        if (!loopTrack) return;
        const items = loopTrack.querySelectorAll('.masonry-item');
        items.forEach(item => {
          const img = item.querySelector('img');
          if (!img) return;
          const key = img.getAttribute('src');
          item.dataset.storyKey = key;
          let overlay = item.querySelector('.story-overlay');
          if (!overlay) {
            overlay = document.createElement('div');
            overlay.className = 'story-overlay';
            item.appendChild(overlay);
          }
          const storyText = storyStore[key];
          overlay.textContent = storyText || '点击添加故事';
          item.classList.toggle('has-story', Boolean(storyText));

          if (!item.dataset.storyBound) {
            item.addEventListener('click', () => {
              const current = storyStore[key] || '';
              const next = prompt('写下这张照片的故事：', current);
              if (next === null) return;
              if (!next.trim()) {
                delete storyStore[key];
              } else {
                storyStore[key] = next.trim();
              }
              localStorage.setItem(STORY_KEY, JSON.stringify(storyStore));
              attachStoryHandlers();
            });
            item.dataset.storyBound = 'true';
          }
        });
      };
      const heroCard = document.getElementById('hero-card-photo');
      const heroUpload = document.getElementById('hero-card-upload');
      const heroInput = document.getElementById('hero-card-input');
      const heroEdit = document.getElementById('hero-card-edit');
      const heroTitle = document.getElementById('hero-title');
      const heroDesc = document.getElementById('hero-description');
      const HERO_KEY = 'hero-card-photo';
      const HERO_TEXT_KEY = 'hero-card-text';
      if (loopTrack) {
        const baseGalleryHTML = loopTrack.innerHTML;
        const storedPhotos = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
        const renderPhoto = ({ src, label }) => `
          <figure class="masonry-item">
            <img src="${src}" alt="${label}">
            <span>${label}</span>
          </figure>`;
        const updateLoop = () => {
          const persisted = storedPhotos.map(renderPhoto).join('');
          const combined = baseGalleryHTML + persisted;
          loopTrack.innerHTML = combined + combined;
          attachStoryHandlers();
        };
        updateLoop();

        if (galleryAddBtn && galleryAddInput) {
          galleryAddBtn.addEventListener('click', () => galleryAddInput.click());
          galleryAddInput.addEventListener('change', () => {
            const [file] = galleryAddInput.files || [];
            if (!file) return;
            const defaultLabel = file.name.replace(/\.[^/.]+$/, '');
            const label = prompt('为这张照片写个注释：', defaultLabel || '旅途影像') || '旅途影像';
            const reader = new FileReader();
            reader.onload = e => {
              const data = e.target?.result;
              if (!data) return;
              storedPhotos.push({ src: data, label });
              localStorage.setItem(GALLERY_KEY, JSON.stringify(storedPhotos));
              updateLoop();
            };
            reader.readAsDataURL(file);
          });
        }
      }

      if (heroCard && heroUpload && heroInput && heroEdit && heroTitle && heroDesc) {
        const cachedHero = localStorage.getItem(HERO_KEY);
        if (cachedHero) {
          heroCard.style.setProperty('--hero-photo', `url(${cachedHero})`);
          heroCard.style.backgroundImage = `var(--hero-photo)`;
        }
        const cachedText = JSON.parse(localStorage.getItem(HERO_TEXT_KEY) || '{}');
        if (cachedText.title) heroTitle.textContent = cachedText.title;
        if (cachedText.desc) heroDesc.textContent = cachedText.desc;
        heroUpload.addEventListener('click', () => heroInput.click());
        heroInput.addEventListener('change', () => {
          const [file] = heroInput.files || [];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = e => {
            const data = e.target?.result;
            if (!data) return;
            heroCard.style.backgroundImage = `url(${data})`;
            localStorage.setItem(HERO_KEY, data);
          };
          reader.readAsDataURL(file);
        });
        heroEdit.addEventListener('click', () => {
          const newTitle = prompt('输入足迹标题：', heroTitle.textContent) || heroTitle.textContent;
          const newDesc = prompt('输入足迹描述：', heroDesc.textContent) || heroDesc.textContent;
          heroTitle.textContent = newTitle;
          heroDesc.textContent = newDesc;
          localStorage.setItem(HERO_TEXT_KEY, JSON.stringify({ title: newTitle, desc: newDesc }));
        });
      }
    </script>
  </body>
</html>
